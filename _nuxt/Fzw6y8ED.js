var nt=Object.defineProperty;var et=(i,t,n)=>t in i?nt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;var V=(i,t,n)=>et(i,typeof t!="symbol"?t+"":t,n);import{O as at,P as ot,Q as st,r as U,B as it}from"./BJ-TQPaP.js";import{s as rt}from"./x_rD_Ya3.js";const lt="$s";function $(...i){const t=typeof i[i.length-1]=="string"?i.pop():void 0;typeof i[0]!="string"&&i.unshift(t);const[n,a]=i;if(!n||typeof n!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+n);if(a!==void 0&&typeof a!="function")throw new Error("[nuxt] [useState] init must be a function: "+a);const w=lt+n,r=at(),M=ot(r.payload.state,w);if(M.value===void 0&&a){const u=a();if(st(u))return r.payload.state[w]=u,u;M.value=u}return M}class ct{constructor(){V(this,"permutation",[]);V(this,"p",[]);this.permutation=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.p=new Array(512);for(let t=0;t<256;t++)this.p[256+t]=this.p[t]=this.permutation[t]}fade(t){return t*t*t*(t*(t*6-15)+10)}lerp(t,n,a){return n+t*(a-n)}grad(t,n,a,w){const r=t&15,M=r<8?n:a,u=r<4?a:r===12||r===14?n:w;return((r&1)===0?M:-M)+((r&2)===0?u:-u)}noise(t,n,a){const w=Math.floor(t)&255,r=Math.floor(n)&255,M=Math.floor(a)&255;t-=Math.floor(t),n-=Math.floor(n),a-=Math.floor(a);const u=this.fade(t),I=this.fade(n),W=this.fade(a),X=this.p[w]+r,A=this.p[X]+M,H=this.p[X+1]+M,L=this.p[w+1]+r,R=this.p[L]+M,Y=this.p[L+1]+M;return this.lerp(W,this.lerp(I,this.lerp(u,this.grad(this.p[A],t,n,a),this.grad(this.p[R],t-1,n,a)),this.lerp(u,this.grad(this.p[H],t,n-1,a),this.grad(this.p[Y],t-1,n-1,a))),this.lerp(I,this.lerp(u,this.grad(this.p[A+1],t,n,a-1),this.grad(this.p[R+1],t-1,n,a-1)),this.lerp(u,this.grad(this.p[H+1],t,n-1,a-1),this.grad(this.p[Y+1],t-1,n-1,a-1))))}}const P=U(null);let C=null;const O=U(null);let q=0,D=0,Z=0,E=null,B=0,T=null,Q=0,_=0,j=1;const J=["A","T","C","G"],ht=new ct;function pt(){const i=$("dna-opacity",()=>1),t=$("dna-visible",()=>!0),n=$("dna-progress",()=>0),a=$("dna-mutations",()=>new Map),w=$("dna-mutation-keys",()=>[]),r=$("dna-flow-offset",()=>0),M=o=>{i.value=o},u=o=>{t.value=o},I=()=>{if(!P.value)return;const o=P.value,e=o.getContext("2d");if(!e)return;e.setTransform(1,0,0,1,0,0);const s=window.innerWidth,f=window.innerHeight,l=window.devicePixelRatio||1;Q=s,_=f,j=l,o.width=Math.max(1,Math.floor(s*l)),o.height=Math.max(1,Math.floor(f*l)),o.style.width=`${s}px`,o.style.height=`${f}px`;const b=16,k=8,x=f*2,c=Math.ceil(x/b),y=Math.ceil(s/k);B=c*b,q=c,D=y,Z=c*y,C=document.createElement("canvas"),C.width=Math.max(1,Math.floor(Q*l)),C.height=Math.max(1,Math.floor(B*l));const h=C.getContext("2d");if(!h)return;h.setTransform(1,0,0,1,0,0),h.scale(l,l),h.font='14px "Proto Mono", monospace',h.textBaseline="top";const m=[],p=.05;for(let g=0;g<c;g++){const v=[];for(let d=0;d<y;d++){const K=J[Math.floor(Math.random()*4)];v.push(K);const S=(ht.noise(d*p,g*p,0)+1)/2,G=.06+S*.27,N=20+Math.floor(S*20),z=100+Math.floor(S*100),tt=50+Math.floor(S*40);h.fillStyle=`rgba(${N},${z},${tt},${G})`,h.fillText(K,d*k,g*b)}m.push(v)}O.value=m,W()},W=()=>{if(!P.value||!C)return;const o=P.value,e=o.getContext("2d");if(!e)return;const s=j||1,f=Q||o.width/s,l=_||o.height/s;e.setTransform(1,0,0,1,0,0),e.scale(s,s),o.style.opacity=i.value.toString();const b=16,k=8;if(e.clearRect(0,0,f,l),B===0)return;const x=r.value%B;e.drawImage(C,0,0,C.width,C.height,0,x,f,B),e.drawImage(C,0,0,C.width,C.height,0,x-B,f,B),t.value&&a.value.size>0&&(e.font='14px "Proto Mono", monospace',e.textBaseline="top",a.value.forEach((c,y)=>{const[h,m]=y.split("-"),p=parseInt(h),v=parseInt(m)*k,d=(p*b+r.value)%B;if(d>-16&&d<l){e.fillStyle="black",e.fillRect(v-2,d,k+4,b);const K=Math.random()>.7?Math.random()*3+1:2;e.fillStyle=`rgba(59, 130, 246, ${.4+Math.random()*.3})`,e.fillText(c.newChar,v+K,d);const F=.5+Math.random()*.4;if(Math.random()>.85)e.fillStyle=`rgba(255, 255, 255, ${F})`;else{const S=240+Math.floor(Math.random()*15),G=Math.floor(Math.random()*20),N=50+Math.floor(Math.random()*30);e.fillStyle=`rgba(${S},${G},${N},${F})`}e.fillText(c.newChar,v,d)}}))},X=o=>{const e=J.filter(s=>s!==o);return e[Math.floor(Math.random()*e.length)]},A=(o,e)=>{var l;const s=`${o}-${e}`;if(!O.value||a.value.has(s))return!1;const f=(l=O.value[o])==null?void 0:l[e];return f?(a.value.set(s,{originalChar:f,newChar:X(f)}),w.value.push(s),!0):!1},H=()=>{a.value.clear(),w.value=[]},L=()=>{I()},R=o=>{if(T&&(clearTimeout(T),T=null),!o){n.value=0,H();return}if(!O.value||q===0||D===0)return;const e=q,s=D,f=Z,l=Math.min(100,n.value+2),b=Math.floor(l/100*f);if(b>a.value.size){const k=b-a.value.size;if(a.value.size===0){const x=Math.min(k,10),c=s/2,y=e/2,h=Math.min(s,e)*.1;for(let m=0;m<x;m++){const p=m/x*Math.PI*2+Math.random()*.3,g=h*(.9+Math.random()*.4),v=Math.max(0,Math.min(s-1,Math.floor(c+Math.cos(p)*g))),d=Math.max(0,Math.min(e-1,Math.floor(y+Math.sin(p)*g)));A(d,v)}}for(let x=0;x<k&&x<50;x++)if(a.value.size>0&&Math.random()<.85){const c=w.value;if(c.length===0)continue;const y=c[Math.floor(Math.random()*c.length)],[h,m]=y.split("-").map(Number),p=Math.floor(Math.random()*5)-2,g=Math.floor(Math.random()*5)-2,v=Math.max(0,Math.min(s-1,m+p)),d=Math.max(0,Math.min(e-1,h+g));A(d,v)}else{const c=s/2,y=e/2,h=Math.max(s,e)*(.3+n.value/200),m=Math.random()*Math.PI*2,p=h*Math.random(),g=Math.max(0,Math.min(s-1,Math.floor(c+Math.cos(m)*p))),v=Math.max(0,Math.min(e-1,Math.floor(y+Math.sin(m)*p)));A(v,g)}}n.value=l,n.value<100&&(T=setTimeout(()=>R(o),100))},Y=()=>{if(E)return;const o=()=>{r.value+=.5,W(),E=requestAnimationFrame(o)};o()};return{canvasBg:P,mutationProgression:n,progressMutation:R,resetMutation:()=>{T&&(clearTimeout(T),T=null),n.value=0,H()},regenerateBackground:L,initBackground:async o=>{P.value=o,await it(),I(),window.addEventListener("resize",I),Y();const e=rt(()=>{n.value===0&&L()},8e3);return()=>{clearInterval(e),T&&clearTimeout(T),window.removeEventListener("resize",I),E&&(cancelAnimationFrame(E),E=null)}},setOpacity:M,setMutationVisibility:u}}export{pt as u};
